<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>受診アンケート</title>
  <style>
    :root{
      --bg1:#d6eaf8; --bg2:#fef9e7; --bg3:#e8f8f5;
      --card:#ffffff; --border:#e5e7eb; --text:#0f172a; --muted:#64748b; --brand:#0ea5e9;
    }
    body{margin:0; font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans JP",sans-serif;
      background: linear-gradient(120deg,var(--bg1),var(--bg2),var(--bg3)); background-size:600% 600%;
      animation: bgmove 20s ease infinite; color:var(--text);
    }
    @keyframes bgmove{ 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
    .wrap{max-width:720px; margin:20px auto; padding:16px;}
    .card{background:var(--card); border:1px solid var(--border); border-radius:14px; padding:16px; box-shadow:0 8px 24px rgba(0,0,0,.05)}
    h1{font-size:18px; margin:0 0 12px;}
    .question{margin:14px 0;}
    .options{display:grid; grid-template-columns:1fr 1fr; gap:8px;}
    .options label{display:flex; align-items:center; gap:8px; padding:10px; border:1px solid var(--border); border-radius:10px;}
    textarea{width:100%; height:90px; padding:10px; border:1px solid var(--border); border-radius:10px; font-size:14px;}
    .muted{color:var(--muted); font-size:12px;}
    .actions{margin-top:16px; display:flex; gap:10px; align-items:center;}
    button{padding:12px 16px; border-radius:12px; border:1px solid var(--border); background:var(--brand); color:#fff; font-weight:600; cursor:pointer;}
    button:disabled{opacity:.6; cursor:not-allowed;}
    .helper{font-size:12px; color:#475569; margin-top:6px;}
    @media (max-width:480px){ .options{grid-template-columns:1fr;} }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>アクセスして頂き、ありがとうございます。お手数ですが以下のアンケートにご協力ください</h1>
      <form id="surveyForm">
        <!-- Q1〜Q10 省略せず全て記載 -->
        <div class="question">
          <p>1. 受診して良かったと思いますか？</p>
          <div class="options">
            <label><input type="radio" name="q1" value="とても良かった" required>とても良かった</label>
            <label><input type="radio" name="q1" value="良かった">良かった</label>
            <label><input type="radio" name="q1" value="普通">普通</label>
            <label><input type="radio" name="q1" value="良くなかった">良くなかった</label>
            <label><input type="radio" name="q1" value="とても良くなかった">とても良くなかった</label>
          </div>
        </div>
        <div class="question">
          <p>2. その理由を教えてください（自由回答）</p>
          <textarea name="q2" placeholder="例）丁寧に症状を聞いてくださり、安心できました。"></textarea>
        </div>
        <div class="question">
          <p>3. 医師の対応はどうでしたか？</p>
          <div class="options">
            <label><input type="radio" name="q3" value="とても良かった" required>とても良かった</label>
            <label><input type="radio" name="q3" value="良かった">良かった</label>
            <label><input type="radio" name="q3" value="普通">普通</label>
            <label><input type="radio" name="q3" value="良くなかった">良くなかった</label>
            <label><input type="radio" name="q3" value="とても良くなかった">とても良くなかった</label>
          </div>
        </div>
        <div class="question">
          <p>4. その理由を教えてください（自由回答）</p>
          <textarea name="q4" placeholder="例）説明が分かりやすく、不安が軽くなりました。"></textarea>
        </div>
        <div class="question">
          <p>5. 受付の対応はどうでしたか？</p>
          <div class="options">
            <label><input type="radio" name="q5" value="とても良かった" required>とても良かった</label>
            <label><input type="radio" name="q5" value="良かった">良かった</label>
            <label><input type="radio" name="q5" value="普通">普通</label>
            <label><input type="radio" name="q5" value="良くなかった">良くなかった</label>
            <label><input type="radio" name="q5" value="とても良くなかった">とても良くなかった</label>
          </div>
        </div>
        <div class="question">
          <p>6. その理由を教えてください（自由回答）</p>
          <textarea name="q6" placeholder="例）受付の方が親切で、手続きがスムーズでした。"></textarea>
        </div>
        <div class="question">
          <p>7. 院内の雰囲気はどうでしたか？</p>
          <div class="options">
            <label><input type="radio" name="q7" value="とても良かった" required>とても良かった</label>
            <label><input type="radio" name="q7" value="良かった">良かった</label>
            <label><input type="radio" name="q7" value="普通">普通</label>
            <label><input type="radio" name="q7" value="良くなかった">良くなかった</label>
            <label><input type="radio" name="q7" value="とても良くなかった">とても良くなかった</label>
          </div>
        </div>
        <div class="question">
          <p>8. その理由を教えてください（自由回答）</p>
          <textarea name="q8" placeholder="例）清潔で静か、待ち時間も快適に過ごせました。"></textarea>
        </div>
        <div class="question">
          <p>9. 他の人に受診を勧めますか？</p>
          <div class="options">
            <label><input type="radio" name="q9" value="強く勧める" required>強く勧める</label>
            <label><input type="radio" name="q9" value="勧める">勧める</label>
            <label><input type="radio" name="q9" value="普通">普通</label>
            <label><input type="radio" name="q9" value="勧めない">勧めない</label>
            <label><input type="radio" name="q9" value="絶対勧めない">絶対勧めない</label>
          </div>
        </div>
        <div class="question">
          <p>10. その理由を教えてください（自由回答）</p>
          <textarea name="q10" placeholder="例）家族や友人にも安心して勧められると感じました。"></textarea>
        </div>
        <div class="actions">
          <button type="submit" id="submitBtn">送信</button>
          <span class="helper muted">
　　　　　　</span>
        </div>
      </form>
    </div>
  </div>
  <script>
document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("surveyForm");
  if (!form) return;

  const getRadio = (n) => form.querySelector(`input[name="${n}"]:checked`)?.value || "";
  const getText  = (n) => form.querySelector(`[name="${n}"]`)?.value.trim() || "";

  form.addEventListener("submit", (e) => {
    e.preventDefault();

    const answers = {
      q1:getRadio("q1"), q2:getText("q2"),
      q3:getRadio("q3"), q4:getText("q4"),
      q5:getRadio("q5"), q6:getText("q6"),
      q7:getRadio("q7"), q8:getText("q8"),
      q9:getRadio("q9"), q10:getText("q10")
    };

    const mapG = {"とても良かった":5,"良かった":4,"普通":3,"良くなかった":2,"とても良くなかった":1};
    const mapR = {"強く勧める":5,"勧める":4,"普通":3,"勧めない":2,"絶対勧めない":1};
    const scores = [mapG[answers.q1], mapG[answers.q3], mapG[answers.q5], mapG[answers.q7], mapR[answers.q9]];
    const valid = scores.every(n => typeof n === "number");
    const avg = valid ? scores.reduce((a,b)=>a+b,0)/scores.length : 0;

    if (!valid){ alert("未回答の設問があります。"); return; }

    if (avg >= 3.5) {
      // 高評価 → 口コミ生成ページへ（回答は保持）
      sessionStorage.setItem("clinic_answers", JSON.stringify(answers));
      sessionStorage.setItem("clinic_avg", String(avg));
      window.location.href = "review.html";
    } else {
      // 低評価 → お礼ページへ（必要なら回答は破棄）
      sessionStorage.removeItem("clinic_answers"); // 任意
      sessionStorage.removeItem("clinic_avg");     // 任意
      window.location.href = "thanks.html";
    }
  });
});
</script>

</body>
</html>
